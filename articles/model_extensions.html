<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Model Extensions • splendid</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Model Extensions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">splendid</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ensemble_classification.html">Ensemble Classification using `splendid`</a></li>
    <li><a class="dropdown-item" href="../articles/model_extensions.html">Model Extensions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/AlineTalhouk/splendid/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="model_extensions_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="model_extensions_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="model_extensions_files/viz-1.8.2/viz.js"></script><link href="model_extensions_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="model_extensions_files/grViz-binding-1.0.11/grViz.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Model Extensions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/AlineTalhouk/splendid/blob/master/vignettes/model_extensions.Rmd" class="external-link"><code>vignettes/model_extensions.Rmd</code></a></small>
      <div class="d-none name"><code>model_extensions.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>splendid</code> supports two modelling extensions to how
ensemble classification is performed. Both paradigms are constructed
from a set of binary classifiers. The first extension is called the
<strong>one-vs-all</strong> approach, where each class is compared to
its complement. The second extension utilizes a <strong>sequential
algorithm</strong> to build the ensemble classifier, assigning class
membership sequentially, in the order of highest performance. Our goal
is to provide the user additional options and flexibility with
modelling, since there is no guarantee that prediction accuracy is
improved.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="co"># devtools::install_github("AlineTalhouk/splendid")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/AlineTalhouk/splendid" class="external-link">splendid</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">hgsc</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="one-vs-all">One-Vs-All<a class="anchor" aria-label="anchor" href="#one-vs-all"></a>
</h2>
<p>To build a one-vs-all model, or <code>ova</code> model for short, we
first need to create a binarized class matrix, where each class is
compared to its complement. Take the <code>hgsc</code> data set for
example. The first 10 classes as predicted by TCGA are:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">hgsc</span>, <span class="st">"class.true"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">class</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "PRO.C5" "MES.C1" "DIF.C4" "MES.C1" "MES.C1" "PRO.C5" "DIF.C4" "MES.C1"</span></span>
<span><span class="co">#&gt;  [9] "IMM.C2" "PRO.C5"</span></span></code></pre></div>
<p>The corresponding binarized class matrix is shown in Table 1. We
denote a <code>"0"</code> meaning “not equal” to the class as indicated
by the column name.</p>
<table class="table">
<caption>Table 1: Binarized class matrix for <code>ova</code>
</caption>
<thead><tr class="header">
<th align="left">DIF.C4</th>
<th align="left">IMM.C2</th>
<th align="left">MES.C1</th>
<th align="left">PRO.C5</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">PRO.C5</td>
</tr>
<tr class="even">
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">MES.C1</td>
<td align="left">class_0</td>
</tr>
<tr class="odd">
<td align="left">DIF.C4</td>
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">class_0</td>
</tr>
<tr class="even">
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">MES.C1</td>
<td align="left">class_0</td>
</tr>
<tr class="odd">
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">MES.C1</td>
<td align="left">class_0</td>
</tr>
<tr class="even">
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">PRO.C5</td>
</tr>
<tr class="odd">
<td align="left">DIF.C4</td>
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">class_0</td>
</tr>
<tr class="even">
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">MES.C1</td>
<td align="left">class_0</td>
</tr>
<tr class="odd">
<td align="left">class_0</td>
<td align="left">IMM.C2</td>
<td align="left">class_0</td>
<td align="left">class_0</td>
</tr>
<tr class="even">
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">PRO.C5</td>
</tr>
</tbody>
</table>
<p>Classification proceeds in this fashion for every bootstrap replicate
and algorithm, as specified in <code><a href="../reference/splendid.html">splendid()</a></code>. However, whereas
before we have one model fit, now there are four model fits at each
iteration. Note that k-Nearest Neighbour classification gives the same
results using the multiclass or <code>ova</code> approach because of its
nonparametric nature.</p>
<p>There is a bit of data manipulation required for obtaining the
predicted class and probability matrix. Let K be the number of classes
and N be the number of samples to classify. For each of the K fits,
there is an N by 2 probability matrix from classifying <em>k</em>
vs. <em>not k</em>, <em>k = 1, …, K</em>. We extract the column of
probabilities pertaining to <em>k</em> for each fit and construct an N
by K probability matrix. Of course, the sum of probabilities for each
sample would likely not equate to one. To normalize the probability
matrix, we divide each row by its sum. Finally, the <code>ova</code>
predicted class is taken as the largest probability from each row.</p>
<p>The <code>ova</code> approach would hence produce a probability
matrix that has a similar pattern to the conventional, multiclass
approach but with <em>less extreme</em> values. This results in
potentially more unclassified cases when we choose to threshold the
predictions.</p>
</div>
<div class="section level2">
<h2 id="sequential-algorithm">Sequential Algorithm<a class="anchor" aria-label="anchor" href="#sequential-algorithm"></a>
</h2>
<p>The sequential algorithm follows a more complicated workflow. This is
an ensemble method, meaning that we work with fitted models,
predictions, and evaluation metrics, whereas the <code>ova</code>
approach is integrated in the initial classification.</p>
<p>By <em>sequential</em>, the idea is that we want to sequentially
assign classes in a binary fashion, until all classes have been
assigned. The diagram below is a simple example for a 4-class case.</p>
<div class="grViz html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"diagram":"\ndigraph sequential {\n\n # add node statements\n node [shape = box,\n       style = filled]\n A [label = \"1, 2, 3, 4\", fillcolor = gray]\n B [label = \"3\", fillcolor = tomato]\n C [label = \"Not 3\", fillcolor = red]\n D [label = \"4\", fillcolor = lightblue]\n E [label = \"Not 4\", fillcolor = dodgerblue]\n F [label = \"1\", fillcolor = yellow]\n G [label = \"2\", fillcolor = green]\n\n # add edge statements\n A->B\n A->C\n C->D\n C->E\n E->F\n E->G\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>Notice that in a 4-class case, there are only 3 fits (since the last
binary classification class “2” is the same as class “Not 1”). But how
do we determine the sequence in which classes are assigned? Why did we
classify 3, then 4, then 1 vs. 2 in the example above? We use the
per-class F1-score evaluation metric. The F1-score has been shown to be
more robust than traditional measures such as accuracy, and represents a
balance between precision and recall.</p>
<p>Suppose we fit a set of classifiers with 2 bootstrap replicates on
the <code>xgboost</code> and <code>rf</code> algorithms.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/splendid_model.html">splendid_model</a></span><span class="op">(</span><span class="va">hgsc</span>, <span class="va">class</span>, n <span class="op">=</span> <span class="fl">2</span>, algorithms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"xgboost"</span>, <span class="st">"rf"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Table 2 shows the per-class F1-scores for model fitted and bootstrap
replicate. An logical column indicates whether <code>ova</code> was used
for the particular algorithm.</p>
<table class="table">
<caption>Table 2: Per-class F1-scores by model and bootstrap
replicate</caption>
<thead><tr class="header">
<th align="left">class</th>
<th align="left">model</th>
<th align="left">boot</th>
<th align="right">value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">DIF.C4</td>
<td align="left">xgboost</td>
<td align="left">1</td>
<td align="right">0.7272727</td>
</tr>
<tr class="even">
<td align="left">DIF.C4</td>
<td align="left">xgboost</td>
<td align="left">2</td>
<td align="right">0.6666667</td>
</tr>
<tr class="odd">
<td align="left">DIF.C4</td>
<td align="left">rf</td>
<td align="left">1</td>
<td align="right">0.8155340</td>
</tr>
<tr class="even">
<td align="left">DIF.C4</td>
<td align="left">rf</td>
<td align="left">2</td>
<td align="right">0.8297872</td>
</tr>
<tr class="odd">
<td align="left">IMM.C2</td>
<td align="left">xgboost</td>
<td align="left">1</td>
<td align="right">0.7750000</td>
</tr>
<tr class="even">
<td align="left">IMM.C2</td>
<td align="left">xgboost</td>
<td align="left">2</td>
<td align="right">0.7352941</td>
</tr>
<tr class="odd">
<td align="left">IMM.C2</td>
<td align="left">rf</td>
<td align="left">1</td>
<td align="right">0.9066667</td>
</tr>
<tr class="even">
<td align="left">IMM.C2</td>
<td align="left">rf</td>
<td align="left">2</td>
<td align="right">0.8181818</td>
</tr>
<tr class="odd">
<td align="left">MES.C1</td>
<td align="left">xgboost</td>
<td align="left">1</td>
<td align="right">0.8604651</td>
</tr>
<tr class="even">
<td align="left">MES.C1</td>
<td align="left">xgboost</td>
<td align="left">2</td>
<td align="right">0.8285714</td>
</tr>
<tr class="odd">
<td align="left">MES.C1</td>
<td align="left">rf</td>
<td align="left">1</td>
<td align="right">0.9111111</td>
</tr>
<tr class="even">
<td align="left">MES.C1</td>
<td align="left">rf</td>
<td align="left">2</td>
<td align="right">0.8823529</td>
</tr>
<tr class="odd">
<td align="left">PRO.C5</td>
<td align="left">xgboost</td>
<td align="left">1</td>
<td align="right">0.7472527</td>
</tr>
<tr class="even">
<td align="left">PRO.C5</td>
<td align="left">xgboost</td>
<td align="left">2</td>
<td align="right">0.8085106</td>
</tr>
<tr class="odd">
<td align="left">PRO.C5</td>
<td align="left">rf</td>
<td align="left">1</td>
<td align="right">0.8636364</td>
</tr>
<tr class="even">
<td align="left">PRO.C5</td>
<td align="left">rf</td>
<td align="left">2</td>
<td align="right">0.9148936</td>
</tr>
</tbody>
</table>
<p>We then calculate the average <code>value</code> across
<code>model</code> and <code>boot</code> to obtain the mean F1-score
across algorithms and replicates. The model associated with the
<em>maximum</em> mean F1-score for a certain class will be used for its
sequential algorithm. Finally, the sequence of fits is determined by
descending magnitude of this maximum mean F1-score.</p>
<p>Table 3 shows that the class “MES.C1” had the highest mean F1-score,
and the model that produced it was <code>rf</code>, and so on. This
means we first fit “MES.C1” vs. “Not MES.C1” using <code>rf</code>, then
“IMM.C2” vs. “Not IMM.C2” using <code>xgboost</code>, and finally
“PRO.C5” vs. “DIF.C4” using <code>rf</code>. The information in the last
row of Table 3 is simply for reference.</p>
<table class="table">
<caption>Table 3: Ranked classes and associated models</caption>
<thead><tr class="header">
<th align="right">rank</th>
<th align="left">class</th>
<th align="left">model</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">MES.C1</td>
<td align="left">rf</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">PRO.C5</td>
<td align="left">rf</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">IMM.C2</td>
<td align="left">rf</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">DIF.C4</td>
<td align="left">rf</td>
</tr>
</tbody>
</table>
<p>A slightly different binarized class matrix is needed as a
result:</p>
<table class="table">
<caption>Table 4: Binarized class matrix for sequential
algorithm</caption>
<thead><tr class="header">
<th align="left">IMM.C2</th>
<th align="left">MES.C1</th>
<th align="left">PRO.C5</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">PRO.C5</td>
</tr>
<tr class="even">
<td align="left">class_0</td>
<td align="left">MES.C1</td>
<td align="left">class_0</td>
</tr>
<tr class="odd">
<td align="left">DIF.C4</td>
<td align="left">class_0</td>
<td align="left">class_0</td>
</tr>
<tr class="even">
<td align="left">class_0</td>
<td align="left">MES.C1</td>
<td align="left">class_0</td>
</tr>
<tr class="odd">
<td align="left">class_0</td>
<td align="left">MES.C1</td>
<td align="left">class_0</td>
</tr>
<tr class="even">
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">PRO.C5</td>
</tr>
<tr class="odd">
<td align="left">DIF.C4</td>
<td align="left">class_0</td>
<td align="left">class_0</td>
</tr>
<tr class="even">
<td align="left">class_0</td>
<td align="left">MES.C1</td>
<td align="left">class_0</td>
</tr>
<tr class="odd">
<td align="left">IMM.C2</td>
<td align="left">class_0</td>
<td align="left">class_0</td>
</tr>
<tr class="even">
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">PRO.C5</td>
</tr>
</tbody>
</table>
<p>Table 4 is similar in nature to Table 1, except that the two
“worst-classified” classes are grouped together (i.e. “PRO.C5” and
“DIF.C4”). In each sequential fit, the nonzero rows are removed from the
entire matrix and the classified class column is removed. This means in
the final sequential fit, the matrix reduces to a single column of
“PRO.C5” and “DIF.C4” values.</p>
<p>The prediction output is generated from applying the sequential
algorithm on the <strong>full data</strong>. We can extract the
binarized probability matrices and also the 2-by-2 confusion
matrices.</p>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>The <code>ova</code> approach can be used in <code><a href="../reference/splendid.html">splendid()</a></code>
by setting <code>ova = TRUE</code>. For every algorithm specified in
<code>algorithms</code>, an analogous <code>ova</code> version is
implemented. All pertinent results are labelled with the string
<code>ova_algorithm_name</code>.</p>
<p>The <code>sequential</code> algorithm can be used to construct an
ensemble classifier by setting <code>sequential = TRUE</code> in
<code><a href="../reference/splendid.html">splendid()</a></code>.</p>
<p>Please read the function documentation for further details.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Derek Chiu, Aline Talhouk, Dustin Johnson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>

<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Model Extensions • splendid</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Model Extensions">
<meta property="og:description" content="splendid">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">splendid</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/AlineTalhouk/splendid">
    <span class="fas fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="model_extensions_files/header-attrs-2.6/header-attrs.js"></script><script src="model_extensions_files/htmlwidgets-1.5.3/htmlwidgets.js"></script><script src="model_extensions_files/viz-1.8.2/viz.js"></script><link href="model_extensions_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="model_extensions_files/grViz-binding-1.0.6.1/grViz.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Model Extensions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/AlineTalhouk/splendid/blob/master/vignettes/model_extensions.Rmd"><code>vignettes/model_extensions.Rmd</code></a></small>
      <div class="hidden name"><code>model_extensions.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p><code>splendid</code> supports two modelling extensions to how ensemble classification is performed. Both paradigms are constructed from a set of binary classifiers. The first extension is called the <strong>one-vs-all</strong> approach, where each class is compared to its complement. The second extension utilizes a <strong>sequential algorithm</strong> to build the ensemble classifier, assigning class membership sequentially, in the order of highest performance. Our goal is to provide the user additional options and flexibility with modelling, since there is no guarantee that prediction accuracy is improved.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="co"># devtools::install_github("AlineTalhouk/splendid")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/AlineTalhouk/splendid">splendid</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">hgsc</span><span class="op">)</span></code></pre></div>
</div>
<div id="one-vs-all" class="section level2">
<h2 class="hasAnchor">
<a href="#one-vs-all" class="anchor"></a>One-Vs-All</h2>
<p>To build a one-vs-all model, or <code>ova</code> model for short, we first need to create a binarized class matrix, where each class is compared to its complement. Take the <code>hgsc</code> data set for example. The first 10 classes as predicted by TCGA are:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">hgsc</span>, <span class="st">"class.true"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">class</span>, <span class="fl">10</span><span class="op">)</span>
<span class="co">#&gt;  [1] "PRO.C5" "MES.C1" "DIF.C4" "MES.C1" "MES.C1" "PRO.C5" "DIF.C4" "MES.C1"</span>
<span class="co">#&gt;  [9] "IMM.C2" "PRO.C5"</span></code></pre></div>
<p>The corresponding binarized class matrix is shown in Table 1. We denote a <code>"0"</code> meaning “not equal” to the class as indicated by the column name.</p>
<table class="table">
<caption>Table 1: Binarized class matrix for <code>ova</code>
</caption>
<thead><tr class="header">
<th align="left">DIF.C4</th>
<th align="left">IMM.C2</th>
<th align="left">MES.C1</th>
<th align="left">PRO.C5</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">PRO.C5</td>
</tr>
<tr class="even">
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">MES.C1</td>
<td align="left">class_0</td>
</tr>
<tr class="odd">
<td align="left">DIF.C4</td>
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">class_0</td>
</tr>
<tr class="even">
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">MES.C1</td>
<td align="left">class_0</td>
</tr>
<tr class="odd">
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">MES.C1</td>
<td align="left">class_0</td>
</tr>
<tr class="even">
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">PRO.C5</td>
</tr>
<tr class="odd">
<td align="left">DIF.C4</td>
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">class_0</td>
</tr>
<tr class="even">
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">MES.C1</td>
<td align="left">class_0</td>
</tr>
<tr class="odd">
<td align="left">class_0</td>
<td align="left">IMM.C2</td>
<td align="left">class_0</td>
<td align="left">class_0</td>
</tr>
<tr class="even">
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">PRO.C5</td>
</tr>
</tbody>
</table>
<p>Classification proceeds in this fashion for every bootstrap replicate and algorithm, as specified in <code><a href="../reference/splendid.html">splendid()</a></code>. However, whereas before we have one model fit, now there are four model fits at each iteration. Note that k-Nearest Neighbour classification gives the same results using the multiclass or <code>ova</code> approach because of its nonparametric nature.</p>
<p>There is a bit of data manipulation required for obtaining the predicted class and probability matrix. Let K be the number of classes and N be the number of samples to classify. For each of the K fits, there is an N by 2 probability matrix from classifying <em>k</em> vs. <em>not k</em>, <em>k = 1, …, K</em>. We extract the column of probabilities pertaining to <em>k</em> for each fit and construct an N by K probability matrix. Of course, the sum of probabilities for each sample would likely not equate to one. To normalize the probability matrix, we divide each row by its sum. Finally, the <code>ova</code> predicted class is taken as the largest probability from each row.</p>
<p>The <code>ova</code> approach would hence produce a probability matrix that has a similar pattern to the conventional, multiclass approach but with <em>less extreme</em> values. This results in potentially more unclassified cases when we choose to threshold the predictions.</p>
</div>
<div id="sequential-algorithm" class="section level2">
<h2 class="hasAnchor">
<a href="#sequential-algorithm" class="anchor"></a>Sequential Algorithm</h2>
<p>The sequential algorithm follows a more complicated workflow. This is an ensemble method, meaning that we work with fitted models, predictions, and evaluation metrics, whereas the <code>ova</code> approach is integrated in the initial classification.</p>
<p>By <em>sequential</em>, the idea is that we want to sequentially assign classes in a binary fashion, until all classes have been assigned. The diagram below is a simple example for a 4-class case.</p>
<div id="htmlwidget-d44619e22126f20b9cec" style="width:700px;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-d44619e22126f20b9cec">{"x":{"diagram":"\ndigraph sequential {\n\n # add node statements\n node [shape = box,\n       style = filled]\n A [label = \"1, 2, 3, 4\", fillcolor = gray]\n B [label = \"3\", fillcolor = tomato]\n C [label = \"Not 3\", fillcolor = red]\n D [label = \"4\", fillcolor = lightblue]\n E [label = \"Not 4\", fillcolor = dodgerblue]\n F [label = \"1\", fillcolor = yellow]\n G [label = \"2\", fillcolor = green]\n\n # add edge statements\n A->B\n A->C\n C->D\n C->E\n E->F\n E->G\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>Notice that in a 4-class case, there are only 3 fits (since the last binary classification class “2” is the same as class “Not 1”). But how do we determine the sequence in which classes are assigned? Why did we classify 3, then 4, then 1 vs. 2 in the example above? We use the per-class F1-score evaluation metric. The F1-score has been shown to be more robust than traditional measures such as accuracy, and represents a balance between precision and recall.</p>
<p>Suppose we fit a set of classifiers with 2 bootstrap replicates on the <code>xgboost</code> and <code>rf</code> algorithms.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/splendid_model.html">splendid_model</a></span><span class="op">(</span><span class="va">hgsc</span>, <span class="va">class</span>, n <span class="op">=</span> <span class="fl">2</span>, algorithms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"xgboost"</span>, <span class="st">"rf"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Table 2 shows the per-class F1-scores for model fitted and bootstrap replicate. An logical column indicates whether <code>ova</code> was used for the particular algorithm.</p>
<table class="table">
<caption>Table 2: Per-class F1-scores by model and bootstrap replicate</caption>
<thead><tr class="header">
<th align="left">model</th>
<th align="left">boot</th>
<th align="left">class</th>
<th align="right">value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">xgboost</td>
<td align="left">1</td>
<td align="left">DIF.C4</td>
<td align="right">0.6138614</td>
</tr>
<tr class="even">
<td align="left">xgboost</td>
<td align="left">1</td>
<td align="left">IMM.C2</td>
<td align="right">0.6666667</td>
</tr>
<tr class="odd">
<td align="left">xgboost</td>
<td align="left">1</td>
<td align="left">MES.C1</td>
<td align="right">0.7472527</td>
</tr>
<tr class="even">
<td align="left">xgboost</td>
<td align="left">1</td>
<td align="left">PRO.C5</td>
<td align="right">0.7128713</td>
</tr>
<tr class="odd">
<td align="left">xgboost</td>
<td align="left">2</td>
<td align="left">DIF.C4</td>
<td align="right">0.7311828</td>
</tr>
<tr class="even">
<td align="left">xgboost</td>
<td align="left">2</td>
<td align="left">IMM.C2</td>
<td align="right">0.8125000</td>
</tr>
<tr class="odd">
<td align="left">xgboost</td>
<td align="left">2</td>
<td align="left">MES.C1</td>
<td align="right">0.7323944</td>
</tr>
<tr class="even">
<td align="left">xgboost</td>
<td align="left">2</td>
<td align="left">PRO.C5</td>
<td align="right">0.8518519</td>
</tr>
<tr class="odd">
<td align="left">rf</td>
<td align="left">1</td>
<td align="left">DIF.C4</td>
<td align="right">0.8411215</td>
</tr>
<tr class="even">
<td align="left">rf</td>
<td align="left">1</td>
<td align="left">IMM.C2</td>
<td align="right">0.8809524</td>
</tr>
<tr class="odd">
<td align="left">rf</td>
<td align="left">1</td>
<td align="left">MES.C1</td>
<td align="right">0.8988764</td>
</tr>
<tr class="even">
<td align="left">rf</td>
<td align="left">1</td>
<td align="left">PRO.C5</td>
<td align="right">0.8936170</td>
</tr>
<tr class="odd">
<td align="left">rf</td>
<td align="left">2</td>
<td align="left">DIF.C4</td>
<td align="right">0.8351648</td>
</tr>
<tr class="even">
<td align="left">rf</td>
<td align="left">2</td>
<td align="left">IMM.C2</td>
<td align="right">0.8235294</td>
</tr>
<tr class="odd">
<td align="left">rf</td>
<td align="left">2</td>
<td align="left">MES.C1</td>
<td align="right">0.8800000</td>
</tr>
<tr class="even">
<td align="left">rf</td>
<td align="left">2</td>
<td align="left">PRO.C5</td>
<td align="right">0.9215686</td>
</tr>
</tbody>
</table>
<p>We then calculate the average <code>value</code> across <code>model</code> and <code>boot</code> to obtain the mean F1-score across algorithms and replicates. The model associated with the <em>maximum</em> mean F1-score for a certain class will be used for its sequential algorithm. Finally, the sequence of fits is determined by descending magnitude of this maximum mean F1-score.</p>
<p>Table 3 shows that the class “MES.C1” had the highest mean F1-score, and the model that produced it was <code>rf</code>, and so on. This means we first fit “MES.C1” vs. “Not MES.C1” using <code>rf</code>, then “IMM.C2” vs. “Not IMM.C2” using <code>xgboost</code>, and finally “PRO.C5” vs. “DIF.C4” using <code>rf</code>. The information in the last row of Table 3 is simply for reference.</p>
<table class="table">
<caption>Table 3: Ranked classes and associated models</caption>
<thead><tr class="header">
<th align="right">rank</th>
<th align="left">class</th>
<th align="left">model</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">PRO.C5</td>
<td align="left">rf</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">MES.C1</td>
<td align="left">rf</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">IMM.C2</td>
<td align="left">rf</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">DIF.C4</td>
<td align="left">rf</td>
</tr>
</tbody>
</table>
<p>A slightly different binarized class matrix is needed as a result:</p>
<table class="table">
<caption>Table 4: Binarized class matrix for sequential algorithm</caption>
<thead><tr class="header">
<th align="left">IMM.C2</th>
<th align="left">MES.C1</th>
<th align="left">PRO.C5</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">PRO.C5</td>
</tr>
<tr class="even">
<td align="left">class_0</td>
<td align="left">MES.C1</td>
<td align="left">class_0</td>
</tr>
<tr class="odd">
<td align="left">DIF.C4</td>
<td align="left">class_0</td>
<td align="left">class_0</td>
</tr>
<tr class="even">
<td align="left">class_0</td>
<td align="left">MES.C1</td>
<td align="left">class_0</td>
</tr>
<tr class="odd">
<td align="left">class_0</td>
<td align="left">MES.C1</td>
<td align="left">class_0</td>
</tr>
<tr class="even">
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">PRO.C5</td>
</tr>
<tr class="odd">
<td align="left">DIF.C4</td>
<td align="left">class_0</td>
<td align="left">class_0</td>
</tr>
<tr class="even">
<td align="left">class_0</td>
<td align="left">MES.C1</td>
<td align="left">class_0</td>
</tr>
<tr class="odd">
<td align="left">IMM.C2</td>
<td align="left">class_0</td>
<td align="left">class_0</td>
</tr>
<tr class="even">
<td align="left">class_0</td>
<td align="left">class_0</td>
<td align="left">PRO.C5</td>
</tr>
</tbody>
</table>
<p>Table 4 is similar in nature to Table 1, except that the two “worst-classified” classes are grouped together (i.e. “PRO.C5” and “DIF.C4”). In each sequential fit, the nonzero rows are removed from the entire matrix and the classified class column is removed. This means in the final sequential fit, the matrix reduces to a single column of “PRO.C5” and “DIF.C4” values.</p>
<p>The prediction output is generated from applying the sequential algorithm on the <strong>full data</strong>. We can extract the binarized probability matrices and also the 2-by-2 confusion matrices.</p>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<p>The <code>ova</code> approach can be used in <code><a href="../reference/splendid.html">splendid()</a></code> by setting <code>ova = TRUE</code>. For every algorithm specified in <code>algorithms</code>, an analogous <code>ova</code> version is implemented. All pertinent results are labelled with the string <code>ova_algorithm_name</code>.</p>
<p>The <code>sequential</code> algorithm can be used to construct an ensemble classifier by setting <code>sequential = TRUE</code> in <code><a href="../reference/splendid.html">splendid()</a></code>.</p>
<p>Please read the function documentation for further details.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Derek Chiu, Aline Talhouk, Dustin Johnson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
